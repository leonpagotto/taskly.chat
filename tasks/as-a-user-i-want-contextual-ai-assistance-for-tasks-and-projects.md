## Story: As a user, I want contextual AI assistance for tasks and projects

**Description:**
As a user, I want to have contextual conversations with the AI about my tasks and projects, receiving guidance, instructions, or suggestions to help me make progress and overcome challenges.

### Tasks

- [ ] **Design and Implement Conversation History Storage** [Backend Engineer]
  - Develop and implement database schema and API endpoints to store and retrieve conversation history linked to specific tasks and projects. This is crucial for enabling contextual AI interactions.
    
    *   **Schema Design**: Add fields to task/project tables or create a new `conversation_history` table with foreign keys to tasks/projects and user IDs.
    *   **API Endpoints**: Create endpoints for `POST /tasks/{task_id}/conversations` and `GET /tasks/{task_id}/conversations` to manage conversation segments.
    *   **Data Structure**: Store messages, timestamps, roles (user/AI), and potentially other metadata.
- [ ] **Develop Contextual AI Prompt Engineering Strategy** [Lead AI/ML Engineer]
  - Design and implement the prompt engineering strategy to enable the AI to understand and respond contextually to user queries related to specific tasks and projects. Focus on dynamic prompt construction.
    
    *   **Contextual Data Injection**: Define how task details, project scope, and conversation history are formatted and injected into LLM prompts.
    *   **Role-Playing/Persona**: Experiment with different AI personas (e.g., 'Project Manager Assistant', 'Productivity Coach') to guide responses.
    *   **Instructional Phrasing**: Craft prompts that encourage the AI to provide guidance, instructions, and actionable suggestions rather than generic replies.
- [ ] **Integrate AI Service with Backend for Contextual Queries** [Backend Engineer]
  - Implement the backend logic to connect user queries with the AI service, passing relevant task/project context and conversation history. This will be the central communication point for AI assistance.
    
    *   **AI Service Proxy**: Create a service layer that receives requests, fetches contextual data (task details, history), constructs the AI prompt, and calls the OpenAI API or other LLM.
    *   **Response Handling**: Process and store AI responses, ensuring they are linked back to the originating task/project and conversation.
    *   **Error Handling**: Implement robust error handling for AI service communication failures or rate limits.
- [ ] **Implement UI for Sending Contextual Queries and Displaying AI Responses** [Frontend/Conversational UI Developer]
  - Develop the frontend components that allow users to initiate contextual conversations with the AI and display the AI's guidance, instructions, and suggestions in an intuitive manner.
    
    *   **Chat Interface Enhancement**: Add functionality to explicitly link chat messages to a specific task or project.
    *   **Real-time Response Display**: Integrate WebSockets to display AI responses in real-time as they are generated by the backend.
    *   **Rich Text Rendering**: Implement markdown rendering for AI responses to support bullet points, bold text, code blocks, etc.
    *   **Adaptive UI Elements**: Explore and implement UI components that can dynamically render different types of AI outputs (e.g., an 'action suggestion' card, a 'step-by-step guide' component).
- [ ] **Develop AI Response Post-Processing and Output Structure** [Lead AI/ML Engineer]
  - Define and implement the structure for AI responses to ensure they are actionable and easily consumable by the frontend. This includes refining LLM output and potentially parsing it.
    
    *   **Structured Output**: Guide the AI to provide responses in a predictable format (e.g., JSON structure, specific markdown headings) for easier parsing.
    *   **Actionable Items Extraction**: Implement logic to identify and extract potential actionable items (e.g., 'create a subtask', 'set a reminder') from AI text responses.
    *   **Feedback Loop**: Set up initial mechanisms for collecting user feedback on AI assistance quality and relevance.
- [ ] **Develop Comprehensive Test Cases for Contextual AI Assistance** [QA Engineer]
  - Create detailed test plans and execute test cases to ensure the contextual AI assistance feature works as expected across various scenarios and provides accurate, relevant, and helpful guidance.
    
    *   **Scenario Testing**: Test different contexts: new task, existing task, project overview, overcoming a specific challenge, requesting instructions, asking for suggestions.
    *   **Context Persistence**: Verify that conversation history is correctly maintained and utilized by the AI for subsequent queries within the same context.
    *   **Relevance and Accuracy**: Assess the quality and helpfulness of AI-generated guidance against expected outcomes.
    *   **Edge Cases**: Test with ambiguous queries, very short/long conversation histories, and out-of-scope requests.
- [ ] **Implement Real-time Updates for AI Responses via WebSockets** [Frontend/Conversational UI Developer]
  - Set up and integrate WebSockets for real-time communication between the frontend and backend, enabling instant display of AI responses without needing to poll the server.
    
    *   **WebSocket Server**: Configure a WebSocket server (e.g., using Node.js/Express with `socket.io` or Python/FastAPI with `websockets`).
    *   **Client-Side Integration**: Implement WebSocket client in the frontend to listen for and display AI response messages.
    *   **Event Handling**: Define WebSocket events for `userMessage`, `aiResponse`, `typingIndicator`, etc., to manage real-time chat flow.
